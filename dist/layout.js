var Context, drawText, withCanvas, withGraphicsContext;

Context = {
  canvas: null
};

drawText = function(text, options) {
  var choice, ctx, fillStyle, font, gravity, m, width, x, y, _i, _len, _ref;
  if (options == null) {
    options = {};
  }
  ctx = Context.ctx;
  if (_.isObject(text)) {
    options = text;
  }
  font = options.font, fillStyle = options.fillStyle, x = options.x, y = options.y, gravity = options.gravity, width = options.width;
  gravity || (gravity = '');
  if (options.choices) {
    _ref = options.choices;
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      choice = _ref[_i];
      if (_.isString(choice)) {
        text = choice;
      }
      if (_.isObject(choice)) {
        font = choice.font;
      }
      if (measure_text(text, {
        font: font
      }).width <= options.width) {
        break;
      }
    }
  }
  if (font) {
    ctx.font = font;
  }
  if (fillStyle) {
    ctx.fillStyle = fillStyle;
  }
  m = ctx.measureText(text);
  x || (x = 0);
  y || (y = 0);
  if (gravity.match(/^(top|center|middle|centerbottom)$/i)) {
    x -= m.width / 2;
  }
  if (gravity.match(/^(right|topRight|botRight)$/i)) {
    x -= m.width;
  }
  if (gravity.match(/^(bottom|botLeft|botRight)$/i)) {
    y -= m.emHeightDescent;
  }
  if (gravity.match(/^(top|topLeft|topRight)$/i)) {
    y += m.emHeightAscent;
  }
  return ctx.fillText(text, x, y);
};

withCanvas = function(canvas, cb) {
  var savedCanvas;
  savedCanvas = Context.canvas;
  try {
    Context.canvas = canvas;
    return cb();
  } finally {
    Context.canvas = savedCanvas;
  }
};

withGraphicsContext = function(cb) {
  var ctx;
  ctx = Context.ctx;
  ctx.save();
  try {
    return cb(ctx);
  } finally {
    ctx.restore();
  }
};

module.exports = {
  withCanvas: withCanvas,
  withGraphicsContext: withGraphicsContext
};

/*
//@ sourceMappingURL=layout.js.map
*/